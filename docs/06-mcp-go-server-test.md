# mcp-goを使ったMCPサーバーのテスト

mcp-goを使ったMCPサーバーのテストは、以下を組み合わせることで簡単に行えます。

* mcp-goのSSEClient
* mcp-goのSSEServer
* httptest package

標準入出力を使ったテストも可能だとは思いますが、Goには標準で利用可能なHTTPサーバーのモックに使えるhttptest packageがあるので、こちらを使うのが楽でしょう。

httptest packageを使ったテストについては、mcp-goの `server.NewTestServer` 関数を使うことで簡単にセットアップできます。

## テストの実装

`caesar-mcp/server/server_test.go` が行っている作業は、大体以下の通りです。

1. MCPサーバーを起動する
2. MCPクライアントを起動する
3. MCPクライアントを初期化する
4. MCPクライアントでツールを呼び出す
5. MCPクライアントで結果を取得し、検証する

本物のMCPサーバーを動かしてテストできているので、このテストが通りさえすれば実際にMCPホストに登録して動くことがほぼ保証されると言ってよいでしょう。

### テストの実行

`caesar_rotate` コマンドが正しく実装されていれば、初めから実装されているテストが通るはずです。
`caesar-mcp` ディレクトリで、以下のコマンドを実行してテストを実行してみましょう。

```
go test ./...
```

無事通れば、実装に問題はありません。通らなければ、実装を修正する必要があります。

### テストコードの特徴

MCPクライアントからMCPサーバーに送る引数を、Toolのパラメータの型通りに厳密に型付けすることはできません。
`map[string]any` にするしかないので、ここで意図通りの値を送るようにしましょう。 (意図通りでない型の値を送ってエラーケースを見るのもよいと思います)

```go
"lowercase letters with positive shift": {
    args: map[string]any{
        "text":  "abcxyz", // anyにしかならない
        "shift": 3,        // ここもanyにしかならない
    },
    want: "defabc",
},
```

## 課題

テストケースが一つ空欄で存在しているので、その内容を実装してください。
